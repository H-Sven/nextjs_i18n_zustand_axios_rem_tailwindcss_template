# Next.js Enterprise Template

è¿™æ˜¯ä¸€ä¸ªåŸºäº Next.js (App Router) çš„ç°ä»£åŒ–ä¼ä¸šçº§å‰ç«¯é¡¹ç›®æ¨¡æ¿ï¼Œé›†æˆäº†å›½é™…åŒ–ã€çŠ¶æ€ç®¡ç†ã€ç½‘ç»œè¯·æ±‚å°è£…ã€UI ç»„ä»¶åº“ä»¥åŠä¸¥æ ¼çš„ä»£ç è§„èŒƒé…ç½®ã€‚æ—¨åœ¨æä¾›ä¸€ä¸ªå¼€ç®±å³ç”¨ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„å¼€å‘åŸºç¡€ã€‚

## ğŸš€ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: [Next.js 16](https://nextjs.org/) (App Router)
- **æ ¸å¿ƒåº“**: [React 19](https://react.dev/)
- **è¯­è¨€**: [TypeScript](https://www.typescriptlang.org/)
- **æ ·å¼**: [Tailwind CSS v4](https://tailwindcss.com/)
- **UI ç»„ä»¶**: [shadcn/ui](https://ui.shadcn.com/) (å›¾æ ‡: [Lucide React](https://lucide.dev/icons/))
- **çŠ¶æ€ç®¡ç†**: [Zustand](https://github.com/pmndrs/zustand) (æ”¯æŒæŒä¹…åŒ–)
- **å›½é™…åŒ–**: [next-intl](https://next-intl-docs.vercel.app/)
- **ç½‘ç»œè¯·æ±‚**: [Axios](https://axios-http.com/)
- **å·¥å…·åº“**:
  - [Day.js](https://day.js.org/) (æ—¥æœŸå¤„ç†)
  - [Mitt](https://github.com/developit/mitt) (äº‹ä»¶æ€»çº¿)
- **ä»£ç è§„èŒƒ**: ESLint, Prettier, Husky, Lint-staged

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. æ ¸å¿ƒæ¶æ„

- **App Router**: é‡‡ç”¨ Next.js æœ€æ–°çš„ App Router æ¨¡å¼ã€‚
- **å›½é™…åŒ– (i18n)**:
  - æ·±åº¦é›†æˆ `next-intl`ã€‚
  - æ”¯æŒè·¯ç”±å‰ç¼€ç­–ç•¥ (å¦‚ `/zh/`, `/en/`)ã€‚
  - é»˜è®¤å¼€å¯ `as-needed` æ¨¡å¼ï¼ˆé»˜è®¤è¯­è¨€ä¸å¸¦å‰ç¼€ï¼‰ã€‚
  - ä¸­é—´ä»¶ (`middleware.ts`) è‡ªåŠ¨å¤„ç†è¯­è¨€é‡å®šå‘ã€‚
- **çŠ¶æ€ç®¡ç†**:
  - ä½¿ç”¨ `Zustand` è¿›è¡Œè½»é‡çº§çŠ¶æ€ç®¡ç†ã€‚
  - é›†æˆ `persist` ä¸­é—´ä»¶ï¼Œæ”¯æŒçŠ¶æ€è‡ªåŠ¨æŒä¹…åŒ–åˆ° `localStorage`ã€‚
  - ç¤ºä¾‹ï¼š`src/store/appStore.ts` (è¯­è¨€è®¾ç½®), `src/store/userStore.ts` (ç”¨æˆ·ä¿¡æ¯)ã€‚

### 2. ç½‘ç»œè¯·æ±‚æ·±åº¦å°è£…

- **ä½ç½®**: `src/lib/request.ts`
- **åŠŸèƒ½**:
  - å…¨å±€æ‹¦æˆªå™¨ï¼ˆè¯·æ±‚/å“åº”ï¼‰ã€‚
  - **è‡ªåŠ¨å–æ¶ˆé‡å¤è¯·æ±‚**: ä½¿ç”¨ `AbortController` è‡ªåŠ¨å–æ¶ˆçŸ­æ—¶é—´å†…ç›¸åŒçš„æŒ‚èµ·è¯·æ±‚ã€‚
  - ç»Ÿä¸€é”™è¯¯å¤„ç†ã€‚
  - ç±»å‹å‹å¥½çš„ API è®¾è®¡ã€‚

### 3. UI ä¸ æ ·å¼

- **Tailwind CSS v4**: æœ€æ–°ç‰ˆé…ç½®ï¼Œæ”¯æŒ CSS å˜é‡ã€‚
- **Shadcn UI**: å·²é›†æˆåŸºç¡€ç»„ä»¶ï¼ˆButton, Input ç­‰ï¼‰ã€‚
- **ç§»åŠ¨ç«¯é€‚é…**: è‡ªåŠ¨è½¬æ¢ `px` ä¸º `rem`

### 4. å®ç”¨å·¥å…·

- **WebSocket Hook**:
  - `src/hooks/useWebSocket.ts`
  - æ”¯æŒè‡ªåŠ¨é‡è¿ã€å¿ƒè·³æ£€æµ‹ã€æ‰‹åŠ¨æ–­å¼€/é‡è¿ã€‚
  - ç¤ºä¾‹é¡µé¢ï¼š`/websocket`ã€‚
- **Day.js å°è£…**:
  - `src/lib/dayjs.ts`
  - é¢„ç½®å¸¸ç”¨æ’ä»¶ (`relativeTime`, `isSameOrBefore` ç­‰)ã€‚
  - ç»Ÿä¸€çš„æ—¶é—´æ ¼å¼åŒ–å‡½æ•°ã€‚
- **EventBus**: åŸºäº `mitt` çš„è½»é‡çº§äº‹ä»¶æ€»çº¿ (`src/lib/eventBus.ts`)ã€‚

### 5. å·¥ç¨‹åŒ–é…ç½®

- **å¤šç¯å¢ƒæ”¯æŒ**: æ”¯æŒ `development`, `test`, `pre`, `production` ç­‰ç¯å¢ƒé…ç½®ã€‚
- **ä»£ç è§„èŒƒ**:
  - `ESLint` + `Prettier` è‡ªåŠ¨æ ¼å¼åŒ–ã€‚
  - `Husky` + `lint-staged`: æäº¤å‰è‡ªåŠ¨æ£€æŸ¥ä»£ç å¹¶ä¿®å¤æ ¼å¼ã€‚
  - å¯¼å…¥æ’åº: é›†æˆ `eslint-plugin-simple-import-sort`ã€‚

## ğŸ“‚ ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ messages/              # å›½é™…åŒ–ç¿»è¯‘æ–‡ä»¶ (zh.json, en.json)
â”œâ”€â”€ public/                # é™æ€èµ„æº (svg, images)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/               # API æ¥å£å®šä¹‰
â”‚   â”‚   â””â”€â”€ user.ts        # ç”¨æˆ·ç›¸å…³ API
â”‚   â”œâ”€â”€ app/               # é¡µé¢è·¯ç”± (App Router)
â”‚   â”‚   â”œâ”€â”€ [locale]/      # å›½é™…åŒ–åŠ¨æ€è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ login/     # ç™»å½•é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket/ # WebSocket ç¤ºä¾‹é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx # æ ¹å¸ƒå±€ (åŒ…å« i18n Provider)
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx   # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ favicon.ico    # ç½‘ç«™å›¾æ ‡
â”‚   â”‚   â””â”€â”€ globals.css    # å…¨å±€æ ·å¼ (Tailwind å¼•å…¥)
â”‚   â”œâ”€â”€ components/        # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/            # UI åŸºç¡€ç»„ä»¶ (Button, Input ç­‰)
â”‚   â”œâ”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ useWebSocket.ts # WebSocket å°è£… Hook
â”‚   â”œâ”€â”€ i18n/              # å›½é™…åŒ–é…ç½®
â”‚   â”‚   â”œâ”€â”€ request.ts     # next-intl è¯·æ±‚é…ç½®
â”‚   â”‚   â””â”€â”€ routing.ts     # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ lib/               # å·¥å…·å‡½æ•°åº“
â”‚   â”‚   â”œâ”€â”€ dayjs.ts       # Day.js é…ç½®
â”‚   â”‚   â”œâ”€â”€ eventBus.ts    # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”œâ”€â”€ request.ts     # Axios è¯·æ±‚å°è£…
â”‚   â”‚   â””â”€â”€ utils.ts       # é€šç”¨å·¥å…·å‡½æ•° (cn ç­‰)
â”‚   â”œâ”€â”€ store/             # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ appStore.ts    # åº”ç”¨çº§çŠ¶æ€ (å¦‚è¯­è¨€è®¾ç½®)
â”‚   â”‚   â””â”€â”€ userStore.ts   # ç”¨æˆ·çŠ¶æ€
â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ middleware.ts      # ä¸­é—´ä»¶ (å¤„ç†å›½é™…åŒ–è·¯ç”±é‡å®šå‘)
â”œâ”€â”€ .env.development       # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production        # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.test              # æµ‹è¯•ç¯å¢ƒå˜é‡
â”œâ”€â”€ .husky/                # Git Hooks é…ç½®
â”œâ”€â”€ eslint.config.mjs      # ESLint é…ç½®
â”œâ”€â”€ next.config.ts         # Next.js é…ç½®
â”œâ”€â”€ package.json           # é¡¹ç›®ä¾èµ–ä¸è„šæœ¬
â””â”€â”€ postcss.config.mjs     # PostCSS é…ç½®
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

- Node.js >= 18
- pnpm (æ¨è)

### 2. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000)ã€‚

## ğŸŒ ç¯å¢ƒå˜é‡

é¡¹ç›®ä½¿ç”¨ `.env.*` æ–‡ä»¶ç®¡ç†å¤šç¯å¢ƒé…ç½®ã€‚

### å˜é‡è¯´æ˜

| å˜é‡å                | è¯´æ˜              | ç¤ºä¾‹                                |
| :-------------------- | :---------------- | :---------------------------------- |
| `NEXT_PUBLIC_ENV`     | å½“å‰ç¯å¢ƒæ ‡è¯†      | `development`, `production`, `test` |
| `NEXT_PUBLIC_API_URL` | åç«¯ API æ¥å£åœ°å€ | `http://localhost:3000/api`         |

### ç¯å¢ƒæ–‡ä»¶

- `.env.development`: å¼€å‘ç¯å¢ƒ (`pnpm dev`)
- `.env.test`: æµ‹è¯•ç¯å¢ƒ (`pnpm build:test`)
- `.env.pre`: é¢„å‘å¸ƒç¯å¢ƒ (`pnpm build:pre`)
- `.env.production`: ç”Ÿäº§ç¯å¢ƒ (`pnpm build:prod` æˆ– `pnpm build`)

æ„å»ºç‰¹å®šç¯å¢ƒç‰ˆæœ¬ï¼š

```bash
# æ„å»ºæµ‹è¯•ç¯å¢ƒ
pnpm build:test

# æ„å»ºç”Ÿäº§ç¯å¢ƒ
pnpm build
```

## ğŸš¢ éƒ¨ç½²æŒ‡å—

æœ¬é¡¹ç›®å·²å¼€å¯ `output: 'standalone'` æ¨¡å¼ï¼Œå¹¶é…ç½®äº†è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬ã€‚æ„å»ºåä¼šè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ç‹¬ç«‹éƒ¨ç½²åŒ…ï¼Œæ— éœ€å®‰è£… `node_modules` å³å¯è¿è¡Œã€‚

### 1. æ„å»ºé¡¹ç›®

æ‰§è¡Œæ„å»ºå‘½ä»¤ä¼šè‡ªåŠ¨å®Œæˆæ‰“åŒ…å’Œé™æ€èµ„æºæ•´åˆï¼š

```bash
# æ„å»ºç”Ÿäº§ç¯å¢ƒ
pnpm build:prod

# æ„å»ºé¢„å‘å¸ƒç¯å¢ƒ
pnpm build:pre

# æ„å»ºæµ‹è¯•ç¯å¢ƒ
pnpm build:test
```

æ„å»ºå®Œæˆåï¼Œ`.next/standalone` ç›®å½•å³ä¸ºå®Œæ•´çš„éƒ¨ç½²åŒ…ï¼ˆå·²è‡ªåŠ¨åŒ…å« `public` å’Œ `.next/static` èµ„æºï¼‰ã€‚

### 2. æœ¬åœ°é¢„è§ˆ

æ„å»ºå®Œæˆåï¼Œä½ å¯ä»¥åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ç›´æ¥éªŒè¯æ„å»ºç»“æœï¼š

```bash
pnpm start:standalone
# æˆ–è€…
node .next/standalone/server.js
```

### 3. æœåŠ¡å™¨éƒ¨ç½²

#### è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ (æ¨è)

é¡¹ç›®æ ¹ç›®å½•ä¸‹æä¾›äº† `deploy.sh` è„šæœ¬ï¼Œå¯ä¸€é”®å®Œæˆæ„å»ºã€ä¸Šä¼ å’Œé‡å¯ã€‚

1.  **é…ç½®è„šæœ¬**: ç¼–è¾‘ `deploy.sh`ï¼Œä¿®æ”¹æœåŠ¡å™¨ä¿¡æ¯ï¼š
    ```bash
    SERVER_USER="root"
    SERVER_IP="your.server.ip.address"
    SERVER_DIR="/var/www/next-app"
    ```
2.  **è¿è¡Œéƒ¨ç½²**:

    ```bash
    # éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
    ./deploy.sh test

    # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
    ./deploy.sh prod
    ```

#### æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœéœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œè¯·å‚è€ƒä»¥ä¸‹æ­¥éª¤ï¼š

1.  **ä¸Šä¼ æ–‡ä»¶**ï¼šå°† `.next/standalone/` ç›®å½•ä¸‹çš„**æ‰€æœ‰å†…å®¹**ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ç›®æ ‡ç›®å½•ã€‚
2.  **å¯åŠ¨æœåŠ¡**ï¼šè¿›å…¥æœåŠ¡å™¨ä¸Šçš„ç›®æ ‡ç›®å½•ï¼Œå¯ä»¥é€‰æ‹©ä»¥ä¸‹æ–¹å¼å¯åŠ¨ï¼š

    **æ–¹å¼ä¸€ï¼šä½¿ç”¨ PM2 ç®¡ç† (ç”Ÿäº§æ¨è)**

    æœ¬é¡¹ç›®å·²å†…ç½® `ecosystem.config.js` é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒé›†ç¾¤æ¨¡å¼å’Œè‡ªåŠ¨é‡å¯ã€‚

    ```bash
    # 1. å®‰è£… PM2 (å¦‚æœå°šæœªå®‰è£…)
    npm install -g pm2

    # 2. å¯åŠ¨æœåŠ¡ (è‡ªåŠ¨è¯»å– ecosystem.config.js)
    pm2 start ecosystem.config.js
    ```

    **æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œ**

    ```bash
    node server.js
    ```

> **æç¤º**:
>
> - `standalone` æ¨¡å¼ç”Ÿæˆçš„ `package.json` ä¸åŒ…å«åŸé¡¹ç›®çš„ scriptsï¼Œæ‰€ä»¥æœåŠ¡å™¨ä¸Šé€šå¸¸ç›´æ¥ç”¨ `node server.js` æˆ– PM2 å¯åŠ¨ã€‚
> - **ç¯å¢ƒå˜é‡æ§åˆ¶** (å¦‚ä¿®æ”¹ç«¯å£):
>   - Node: `PORT=8080 HOSTNAME=0.0.0.0 node server.js`
>   - PM2: ä¿®æ”¹ `ecosystem.config.js` æˆ–è¿è¡Œ `PORT=8080 pm2 start ecosystem.config.js`
